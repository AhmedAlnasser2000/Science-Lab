MODEL: gpt-5.2 (Codex) — reasoning_effort=high
Justification: We have a Windows-only recursion/Path corruption failure in icon resolution plus a likely UI growth/regression caused by repeated rebuild/signals. This needs careful Qt wiring + defensive normalization + tests.

Goal
- FIX: Stop recurring console error:
  - AttributeError: 'WindowsPath' object has no attribute '_str' / '_drv'
  - RecursionError: maximum recursion depth exceeded
  originating from app_ui/codesee/icon_pack.py: resolve_icon_path().
- FIX: Stop Code See UI from “getting bigger” over time (likely repeated palette rebuilds/signals and/or tile widgets accumulating).
- Preserve Lens Palette correctness (tiles reflect Lens dropdown; search filters).
- Icon failures must NEVER break the palette; safe fallback icons are required.

Observed facts
- Lens dropdown contains: Atlas, Platform, Content, Bus, Extensibility/Dependencies.
- Palette refresh tries to render tile icons and calls:
  screen.py -> _lens_palette_icon_pixmap(...) -> icon_pack.resolve_icon_path(icon_key, style)
- The crash implies “style” is not a valid string ("mono"/"color"), but a Path-like object.
- UI “getting bigger” strongly suggests duplicate signal connections and/or tile widgets not being cleared and deleted.

Constraints
- Do NOT ask user for snippets; locate and inspect code yourself.
- No new dependencies.
- Must work for BOTH Code See embedded and Code See (Window) variant.
- Preserve pin/unpin and More/Less behavior.

Touchlist

A) Identify style source and ensure it’s a STRING everywhere
1) Locate “Icon:” dropdown in Code See.
2) Verify itemData/currentData values are simple strings (e.g., "auto", "color", "mono") — NOT Path objects.
3) Locate any persisted config for icon style; ensure it loads as string and is validated.
4) Track the exact value/type flowing into icon_pack.resolve_icon_path(icon_key, style).

B) Harden icon_pack.resolve_icon_path against broken “style” inputs (core fix)
At the top of resolve_icon_path:
- Normalize style to allowed style strings: {"color", "mono"}.
- If style is invalid or not string-like: fall back to "color".
- Some Path objects appear “corrupted” in this failure, so even calling str(style) can raise.
  Therefore normalization must be try/except guarded.

Implement helper:

- def _normalize_style(style):
    default = "color"
    if style is None:
        return default
    # Enums
    if hasattr(style, "value"):
        try:
            style = style.value
        except Exception:
            return default
    if isinstance(style, str):
        s = style.strip().lower()
        return s if s in {"color","mono"} else default
    # last-resort coercion, guarded
    try:
        s = str(style).strip().lower()
        return s if s in {"color","mono"} else default
    except Exception:
        return default

Then:
- style_dir = _normalize_style(style)
- base_dir = Path(__file__).resolve().parent / "assets" / "icons" / style_dir

CRITICAL:
- Never do: ... / style  unless style has already been normalized to a safe string.
- Never allow a Path object to be used as a path segment for style.

C) Fix callers so they never pass non-strings
- Ensure palette’s icon resolver passes style as the normalized string only.
- If “auto” exists, resolve it to either "color" or "mono" BEFORE calling resolve_icon_path.
- Ensure toolbar “Icon:” dropdown stores strings and not Path objects (no Path("mono") etc).

D) Add safe fallback in palette icon pixmap generation
In _lens_palette_icon_pixmap (or equivalent):
- Wrap resolve_icon_path() in try/except.
- On exception, return a safe fallback pixmap (cached):
  - either a small drawn glyph (QPainter) or a standard Qt icon pixmap.
- DO NOT let icon failures prevent tile creation.

E) Stop the UI from “getting bigger”
Investigate and fix:

1) Duplicate signal connections
- If set_lens_combo() connects to modelReset/rowsInserted/dataChanged every time palette opens, you may connect repeatedly.
Fix:
- Track the current connected model object.
- If same model, do not reconnect.
- If model changes, disconnect old signals (best effort) before connecting new ones.
- If your Qt binding supports it, prefer Qt.UniqueConnection for connects.

2) Tile widgets not cleared correctly
- In every rebuild:
  - Clear grid layout items and delete widgets:
    while grid.count():
      item = grid.takeAt(0)
      w = item.widget()
      if w: w.deleteLater()
  - Clear strong refs list: self._tile_widgets.clear()
- Ensure rebuild does NOT add additional nested containers each time.
- Do NOT call adjustSize() on the main window during rebuild.

3) Min sizes that “ratchet”
- Audit More/Less logic:
  - Must set explicit constants, not incremental min heights.
  - Ensure repeated toggles do not increase min width/height.

Add debug-gated instrumentation (PHYSICSLAB_CODESEE_DEBUG=1):
- Log refresh counts and whether connections are duplicated:
  - lens_palette_refresh_count
  - model_signal_connections_count (or boolean flags)
  - grid_count after rebuild

F) Tests (required)
- Add unit test for style normalization (icon_pack):
  - None -> "color"
  - "mono" -> "mono"
  - " MONO " -> "mono"
  - "weird" -> "color"
  - object() -> "color" (must not raise)
  - Path("mono") -> "color" or "mono" (must not raise)

Auto-verify
- python -m compileall -q app_ui
- pytest -q

Manual verification
1) Launch app -> open Code See.
2) Open palette and type “pla”:
   - Tiles render; palette does not break even if icons fail.
3) Toggle pin/unpin, More/Less, and type in search repeatedly:
   - UI does NOT grow over time.
4) Confirm terminal no longer prints WindowsPath recursion trace.

Commit message
- fix(V5.5c7) CodeSee icon style normalization; stop recursion; prevent palette growth

Git checkpoint commands
git add -A
git commit -m "fix(V5.5c7) CodeSee icon style normalization; stop recursion; prevent palette growth"
git push
