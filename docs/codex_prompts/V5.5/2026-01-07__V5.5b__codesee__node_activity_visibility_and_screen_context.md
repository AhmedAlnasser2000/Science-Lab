# Model
gpt-5.2-codex — reasoning_effort=medium

## Why this choice
This is focused but multi-file UI work inside CodeSee: node rendering + activity decay + wiring a small “current screen” context signal from app navigation. Medium effort should be enough; bump to high only if the CodeSee rendering stack is more coupled than expected.

---

## Goal
Deliver **V5.5b: Node activity visibility** in CodeSee, and also add **minimal screen-context tracking** so CodeSee knows what top-level screen/window the user is currently viewing (Labs, System Health, LabHost, BlockHost/Component Sandbox, etc.).

### V5.5b success criteria (node visibility)
- Nodes show a **recent-activity visual** (border/glow and/or transient icon) that **fades out** based on last-activity timestamp.
- Visual is driven by a single authoritative `last_activity_ts` per node (seconds).
- Works for:
  - nodes with pulses
  - nodes that receive bridged activity (if CodeSee has a bus bridge)
- Respects reduced-motion preference:
  - if reduced_motion is ON, avoid animated glow; use a short-lived static highlight (e.g., 1s) or a single-step state.
- No regressions to pulse rendering or edge-following behavior (V5.5a).

### Screen-context tracking success criteria (new requirement)
- CodeSee tracks a single “current screen context” string (and optional detail) such as:
  - `MainMenu`, `ContentBrowser`, `SystemHealth`, `LabHost:<lab_id>`, `ComponentSandbox`, etc.
- The screen context updates when the user navigates/open/closes major windows.
- The context is surfaced minimally:
  - either shown in CodeSee UI (e.g., a small label in the CodeSee header/overlay)
  - and/or stored in CodeSee state and emitted as a marker event through existing CodeSee event plumbing
- Keep it lightweight: this is NOT the full session recorder yet. This is just “what screen are we on right now”.

---

## Touchlist
(Discover actual filenames/classes; these are intent-level targets.)
- CodeSee node item rendering/paint class (where nodes are drawn)
- CodeSee scene/controller that manages node models and activity events
- Any existing CodeSee “activity/pulse” ingestion path (including bus bridge if present)
- App navigation / screen switching logic (MainWindow / stacked widget / routing helpers)
- Minimal CodeSee “context” API surface (publish/update current screen)
- Add 1 deterministic unit test for new pure helper logic (activity fade curve), not GUI painting
- `docs/codex_prompts/INDEX.md` (append an entry for this prompt; fill commit hash after landing)

---

## Forbidden list
- No major refactors/renames
- Don’t change runtime_bus/core_center/component_runtime unless strictly required to publish the screen context signal
- No schema/content repo edits
- No new heavy dependencies
- Don’t touch Pillars unless the end-of-milestone review says it’s warranted

---

## Implementation plan
### Part A — Node activity visibility
1) Locate node draw code and current activity state:
   - Identify where pulses / events currently “touch” nodes.
   - Introduce/centralize `last_activity_ts` per node if not present.

2) Add a small pure helper for decay:
   - Example: `activity_alpha(age_s, fade_s=2.0) -> float` (0..1)
   - Deterministic and unit-testable.
   - For reduced-motion: clamp to either 0 or 1 with a short TTL, or a 2-step fade.

3) Paint change:
   - If alpha>0:
     - draw an outer border/glow ring with alpha scaled
     - optionally draw a tiny transient icon/badge (e.g., dot or bolt) with same alpha
   - Keep it subtle; don’t explode layout.

4) Update loop:
   - If CodeSee already ticks for pulses, reuse it to trigger repaints while any node alpha>0.
   - Otherwise add a minimal timer only when needed (and disable when idle).

### Part B — Screen-context tracking (new requirement)
5) Find app navigation points where “current screen” changes:
   - MainMenu → ContentBrowser → SystemHealth → Settings
   - When opening a LabHost / lab part
   - When opening Component Sandbox / “BlockHost” style window if present

6) Add a tiny function to publish context into CodeSee:
   - Prefer: call an existing CodeSee “bridge” or “event bus” module if it exists.
   - Else: expose a very small method on CodeSee controller like:
     - `codesee.set_screen_context(screen_id: str, detail: dict|None)`
   - Store the current value; optionally emit an event/marker (for future recorder use).

7) Surface it in the CodeSee UI:
   - Minimal: a small label like `Screen: SystemHealth` in a corner/header, updated live.
   - If CodeSee has an inspector already, put it there instead of adding new UI.

---

## Tests
- Add 1 unit test for the decay helper:
  - alpha(0) == 1
  - alpha(fade_s) == 0 (or near 0)
  - monotonic decreasing over time
  - reduced-motion branch behaves deterministically

Avoid Qt scene instantiation in tests.

---

## Auto-verify (run these)
- `python -m compileall -q app_ui runtime_bus core_center component_runtime ui_system content_system diagnostics tools`
- `python -m pytest -q`

---

## Manual test checklist
1) Launch: `python -m app_ui.main`
2) Open CodeSee and trigger activity:
   - confirm nodes show a transient highlight/glow that fades out
3) Toggle reduced-motion (if your UI supports it) and confirm highlight becomes non-animated / simplified.
4) Navigate across screens:
   - MainMenu → SystemHealth → ContentBrowser → open a LabHost
   - confirm CodeSee “Screen:” context updates accordingly.
5) Confirm pulses still follow edges (no regression from V5.5a).

---

## End-of-milestone Pillars review
Ask: “Did V5.5b introduce something that deserves a Pillar check?”
- If no: do nothing.
- If yes: add ONE small deterministic Pillar check + unit test.
