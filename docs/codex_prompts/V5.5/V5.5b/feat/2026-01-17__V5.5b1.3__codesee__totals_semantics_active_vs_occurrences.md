# Model
gpt-5.2-codex — reasoning_effort=medium

## Why this choice
Scoped recon + semantics fix in CodeSee status counting (active vs occurrences). Requires tracing a few code paths and adding a small counter store. Medium effort is appropriate.

---

## Goal
**V5.5b1.3 (semantics recon + fix):** In the CodeSee node status dropdown, some per-type totals appear “stuck” (e.g., **Muted activity stays at 8**, UI/app_ui stays at 1) while interacting with the app (see video `d23b9a33-…mp4`).

We need to:
1) **Recon:** Identify what each “total” number represents today (active flags? concurrent items? capped windows? occurrence totals?).
2) **Fix:** Make the dropdown totals **unambiguous and correct**, matching intended meaning:
   - Node pill can stay compact/capped (`8+`, `99+`) to avoid clutter.
   - Dropdown must show **true numbers** and clearly label whether each number is “Active now” vs “Total occurrences”.

---

## Video symptom (must match reproduction)
- Dropdown shows per-type totals (Muted activity, UI/app_ui, etc.) that do not grow with repeated actions.
- Some values plateau or drop → strongly suggests “active/concurrent/windowed” rather than “occurrence total”.

---

## Recon (must do first)
1) Reproduce following the same flow as the video:
   - Open CodeSee, open the node dropdown.
   - Perform repeated actions that should generate more events.
   - Note which counts stick/plateau/drop.

2) Trace data sources for each number:
   - Locate where per-node statuses are computed (e.g., `scene.py:_update_node_statuses`).
   - Locate signal/pulse tracking (e.g., `scene.py:emit_signal`, pulse manager).
   - Locate rail/badge aggregation feeding dropdown (e.g., `items.py:_collect_status_menu_items` or equivalent).
   - Confirm whether “Muted activity (8)” is coming from:
     - a list of active states,
     - a capped queue,
     - a decaying set,
     - or an actual counter.

3) For each badge type, write down current semantics:
   - Context (C): boolean while in mapped screen
   - Activity (A): ??? (likely decay window)
   - Pulses (P): ??? (likely concurrent pulses)
   - Signals (S): ??? (likely bounded queue/concurrency cap)
   - Errors (!): ??? (event count vs active flag)
   - Muted activity: ??? (active muted flag vs occurrences)
   - “UI/app_ui: 1”: ??? (what state/event is this tied to)

Add a short code comment near the mapping/builder summarizing these semantics (3–6 lines).

---

## Implement final semantics (what we want)
### A) Separate “Active now” vs “Total occurrences (session)”
For each badge type shown in the dropdown, show:
- **Active now:** current concurrent/active count (can change up/down)
- **Total occurrences (session):** monotonic counter since CodeSee opened (or since reset)

If “total occurrences” doesn’t exist today, add it.

### B) Dropdown must be self-explanatory
Add a small header at top of dropdown:
- “Counts: Active now / Total (session)”

Then each line should present both:
- `Muted activity: 1 / 23`
- `Signals: 3 / 40`
- `Pulses: 1 / 12`
- `Recent activity: 1 / 58`
- `Errors: 0 / 2`
- `Context: 1 / 1` (or just active for context)

Rules:
- **Active now** may fluctuate (up/down).
- **Total (session)** must be monotonic non-decreasing.

### C) Keep node pill behavior unchanged
- Node pill remains compact/capped (`8+`, `99+`) and does NOT need to equal the dropdown totals.
- Dropdown shows exact totals.

### D) Optional reset
Add a “Reset session totals” action in the dropdown footer to clear the per-node counters.
If too much: reset totals when CodeSee view is recreated.

---

## Implementation strategy (suggested)
1) Add a per-node counter store in the CodeSee scene/controller:
   - `node_counters[node_id][badge_type] += delta` on each occurrence event:
     - signals emitted
     - pulse started
     - activity event recorded
     - error captured
     - muted event recorded
2) Keep existing “active status” computation as-is (decay/concurrency), but don’t label it as “Total”.
3) Dropdown reads:
   - `active_count` from current statuses
   - `total_count` from counter store
4) Ensure updates occur on UI thread (if fed by bus callbacks).

---

## Tests
Add one deterministic unit test for the pure model/formatter:
- Given active counts and total counts, rendered rows include both.
- Total(session) is never capped (`99+`) and never derived from pill text.

Do NOT instantiate Qt in tests.

---

## Auto-verify
- `python -m compileall -q app_ui runtime_bus core_center component_runtime ui_system content_system diagnostics tools`
- `python -m pytest -q`

---

## Manual verification
1) Launch: `python -m app_ui.main`
2) Open CodeSee; open dropdown for a node.
3) Perform repeated actions that generate events.
4) Confirm:
   - Active now counts fluctuate.
   - Total(session) counts only increase.
   - Muted activity is not “stuck at 8” unless there were truly only 8 occurrences.
5) Confirm node pill remains compact (`8+`) and does not force exact totals.

---

## Git checkpoint
git add -A
git commit -m "feat(V5.5b1.3) codesee clarify totals: active vs session occurrence counts"
git push
