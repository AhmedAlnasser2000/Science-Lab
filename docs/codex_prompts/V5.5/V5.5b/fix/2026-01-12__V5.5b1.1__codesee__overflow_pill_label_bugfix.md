# Model
gpt-5.2-codex — reasoning_effort=medium

## Why this choice
This is a small, high-signal bugfix inside CodeSee (badge model/paint). It needs a short recon to identify where the wrong label is coming from, then a localized fix plus a deterministic unit test.

---

## Goal
**V5.5b1.1 fix:** The CodeSee node badge overflow pill is rendering incorrectly (e.g., showing `8C` / `8A` instead of `8+`), and we need to verify whether the red `!` badge is a real error signal or a rendering/aggregation artifact.

This is a correctness fix, not a feature expansion.

---

## Recon (must do first)
1) Reproduce in app:
   - Open CodeSee, navigate to a context that triggers badges (C/A/P), and create enough statuses to force overflow.
   - Observe the overflow pill rendering (wrong text like `8C`).

2) Locate where the pill text is produced:
   - Search for overflow label formatting (e.g., `format_overflow`, `overflow_label`, `pill_label`, `badge_text`).
   - Confirm whether the pill is being treated like a normal badge with a single-letter “code” (C/A/P/!) plus a number.

3) Determine the meaning of the `!` badge in this reproduction:
   - Hover/click the `!` badge to see tooltip/dropdown explanation.
   - Check logs/console for an exception or error event captured by CodeSee.
   - If `!` appears with no actual error events, treat it as a bug in badge derivation.

Record findings in brief comments near the fix (1–3 lines).

---

## Fix requirements
### A) Overflow pill must be a distinct visual kind
- Overflow pill must NOT use the same rendering path as regular letter badges.
- It must always display:
  - `{total}+` for totals >= 5 and < 99 (e.g., `8+`, `17+`)
  - `99+` for totals >= 99
- It must never append badge letters like C/A/P.

### B) Drawing order / occlusion safety
- The overflow pill should be reserved in layout and drawn in a way that can’t be overwritten by subsequent badge draws.
- Clip to badge strip rect.

### C) `!` badge verification
- If the `!` badge is triggered only because of the overflow mis-rendering or aggregation bug, fix that.
- If `!` is a real error signal (from actual exceptions/events), leave it as-is, but ensure its tooltip/dropdown correctly explains why it’s present.

### D) Tests
Add/update one deterministic unit test for:
- `format_overflow(8) == "8+"`
- `format_overflow(17) == "17+"`
- `format_overflow(99) == "99+"`
- `format_overflow(140) == "99+"`
And (if your code has a “badge model builder”):
- overflow pill label is independent of any badge “code” (C/A/P).

No Qt scene/view instantiation in tests.

---

## Touchlist
- CodeSee node badge strip model / aggregation logic
- Overflow pill label formatter
- Node paint routine for overflow pill drawing
- Tooltip/dropdown builder (only if it’s needed to validate `!` meaning)
- Unit test file(s) near existing CodeSee tests

---

## Forbidden list
- No major refactors or renames
- No changes to runtime_bus/core_center/component_runtime
- No schema/content changes
- No new dependencies
- Don’t touch Pillars (bugfix does not warrant a new Pillar)

---

## Auto-verify
- `python -m compileall -q app_ui runtime_bus core_center component_runtime ui_system content_system diagnostics tools`
- `python -m pytest -q`

---

## Manual verification
1) Launch: `python -m app_ui.main`
2) Open CodeSee and reproduce overflow:
   - Confirm pill shows `8+` (not `8C/8A`)
3) Confirm `!` behaves correctly:
   - If present, tooltip/dropdown explains an actual error event
   - If no real error, `!` should not appear
4) Confirm badge strip still:
   - clips properly
   - overflow pill remains visible

---

## Git checkpoint
git add -A
git commit -m "fix(V5.5b1.1) codesee overflow pill label and error badge correctness"
git push
