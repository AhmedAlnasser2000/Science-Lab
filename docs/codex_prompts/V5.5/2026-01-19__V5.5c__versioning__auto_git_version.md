MODEL: gpt-5.1-codex-max (reasoning_effort=medium)
Justification: Multi-file change touching versioning, Pillars P1, and UI title verification. Medium effort is enough for a contained, testable change without broad refactors.

Goal
- Ensure the app window title’s version label (app_version) automatically tracks the latest milestone token (e.g., V5.5c) from git history during dev runs.
- Keep a safe fallback for packaged/release builds where git is unavailable.
- Make Pillar P1 FAIL when git is available but app_version is stale relative to the latest milestone token.

Touchlist
1) app_ui/versioning.py (or wherever get_build_info()/build identity lives)
   - Add helper: detect_git_available() -> bool
     - Prefer checking that invoking `git --version` works (or using shutil.which("git")).
   - Add helper: get_latest_milestone_from_git_log(limit=50) -> Optional[str]
     - Run `git log -n <limit> --pretty=%s` from repo root.
     - Parse commit subjects for milestone token using regex:
       - \\bV\\d+\\.\\d+[A-Za-z0-9.]*\\b
       - Examples matched: V5.5c, V5.4k3, V4.11b
     - Return the FIRST match encountered when scanning from newest to oldest.
   - Implement compute_app_version() -> str
     - If git is available AND a milestone token is found:
       - Return f"{token}-dev" (or return token verbatim—choose one and stick to it).
     - Else:
       - Return fallback version string (existing constant/env/build-time injected).
   - Ensure get_build_info() uses compute_app_version() for app_version.
   - Preserve current behavior for commit hash (e.g., cc5e5c0) and any “dirty” flags if present.

2) Pillars: P1 build identity check (tests/pillars/* and/or tools/pillars_harness.py depending on your layout)
   - Extend P1 so that when git is available AND get_latest_milestone_from_git_log() finds a token:
     - Assert build_info.app_version matches/includes that token.
       - If you add “-dev”, then require token as a substring.
       - If you return token verbatim, require exact match.
     - On mismatch, FAIL with a clear message that includes:
       - expected token
       - actual app_version
       - hint: “versioning not derived from git milestone”

3) UI title verification
   - Confirm the main window title uses build_info.app_version (and still includes the short commit hash).
   - If needed, adjust only the title formatting—not the rest of UI.

Forbidden list
- Do NOT hardcode any specific milestone (e.g., V5.5c) into source.
- Do NOT require git to exist for release builds; must retain non-git fallback.
- Do NOT broaden Pillars beyond P1 for this slice.
- Avoid large refactors (no moving modules, no redesign of build system).

Auto-verify
- Run pillars tests:
  - pytest -q tests/pillars
- Run the app:
  - python -m app_ui.main
- Confirm the title shows the latest milestone token (e.g., “V5.5c-dev” or “V5.5c”) and the current short commit hash.

Manual tests
- Launch app on current main where the latest tagged commit subject includes “docs(V5.5c) …”
  - Expected: title version shows V5.5c (optionally with -dev), not an old “5.2.0-dev” fallback.
- System Health → Pillars → Run
  - Expected: P1 PASS.

Git checkpoint commands
- git add -A
- git commit -m "fix(V5.5c) auto-derive app version from git and enforce via Pillar P1"
- git push
