# V5.5d4 — CodeSee Inspector Relations (Paged lists + Filters)

## Goal
Make the Inspector truly useful for deep understanding **without canvas explosion** by implementing a real **Relations** tab with **paging** and basic filters.

By end of V5.5d4:
- Inspector → **Relations** shows structured relationship lists for the inspected item.
- All potentially-large lists are **paged** (“Load more”), never rendered all at once.
- Basic **search/filter** within each list (simple substring match).
- Strong **empty / stale** states (no crashes, clear messaging).
- Pin/Lock + Back/Forward history continue to work across Relations interactions.

**Non-goals for d4:** Bus lens overlays (d5), trace hooks (d6), premium visuals, log viewers.  
(We will later add a dedicated “Logs/Outputs” surface; do not scope-creep d4.)

---

## Touchlist (allowed)
- `app_ui/codesee/**` (primary)
- `app_ui/screens/**` *(only if CodeSee screen is wired here)*
- `app_ui/widgets/**` *(only if you need a small reusable paged-list widget)*
- `docs/agent_dictionary/**` and `docs/human_dictionary/**` *(only if new UI terms are introduced)*
- `docs/codex_prompts/INDEX.md` *(append entry for this prompt)*

---

## Forbidden list
- Do NOT modify: `core_center/**`, `runtime_bus/**`, `component_runtime/**`, `kernel/**`, `content_system/**`, `ui_system/**`
- No CI/workflow changes, no dependency changes
- No unrelated refactors

---

## Model / thinking level
- Codex mode: **Agent**
- Reasoning level: **mid** (bump to **high** only if model/view complexity forces it)

---

## Deliverable by end of V5.5d4
User can:
1) Inspect any node/module/component and see its **relations** in lists that are never overwhelming.
2) Scroll and **Load more** safely for big modules.
3) Filter/search within a relations list.
4) Navigate inspection history (Back/Forward) without losing UI correctness.

---

## Implementation plan

### 0) Preconditions
V5.5d2 must exist (Inspector + ItemRef + pin/history).  
V5.5d3 Peek mode may exist; d4 must work in both global and Peek contexts.

---

### 1) Define relation categories (minimal, stable)
Implement a relation query layer that can return related ItemRefs for a given inspected ItemRef.

Start with these categories (even if some return empty initially):
- **Contains** (containment children)
- **Contained by** (parent/owner if available)
- **Uses / Depends on** (outgoing dependencies)
- **Used by / Dependents** (incoming dependencies)
Optional (only if already easy to expose from current model):
- **Exports / Entry points**

Important:
- **Do not** invent new graph semantics; map to what CodeSee already knows.
- If dependency data isn’t available, show the category with an empty state.

---

### 2) Build a PagedList UI (reusable component)
Implement a small paged list widget/helper:
- Inputs:
  - `title`
  - `items_provider(offset, limit, filter_text) -> list[ItemRef]` (or list of display rows)
  - `page_size` (default 50)
- UI:
  - Filter box (optional per list)
  - List view (shows friendly name + kind badge; click selects/inspects)
  - “Load more” button (disabled when no more)
  - “Showing N of M” if M known, otherwise “Showing N”

Performance rules:
- Never compute/format thousands of rows in one shot.
- Fetch/format only what is shown.

---

### 3) Relations tab layout
Inspector → Relations tab shows a vertical stack of relation sections (collapsible if needed):
- Contains
- Contained by
- Depends on / Uses
- Used by / Dependents
- (Optional) Exports

Each section uses the PagedList component.

Interaction:
- Clicking an entry should:
  - set `selected_item`
  - if Inspector not pinned, set `inspected_item` (and push history)
  - if pinned, offer an explicit “Inspect” action (button or double-click) OR follow the existing pinned rules (choose the simplest consistent behavior).

---

### 4) Filtering
Implement basic substring filter:
- Filter applies to the display name and/or id.
- Filtering must not break paging.
- Clearing the filter resets paging state.

---

### 5) Empty + stale states
If inspected item is missing/stale:
- Relations tab shows “Item not found (stale)” and a hint:
  - “Go back” (history) or “Select another item”
No exceptions, no tracebacks.

If a category has no items:
- Show “No relations found.”

---

### 6) (Optional) Relation caching (only if needed)
If relation computation is expensive:
- Cache per `(inspected_item, category, filter_text)` with bounded size
- Invalidate cache when graph rebuilds

Keep it simple; do not over-engineer.

---

### 7) Update dictionaries only if needed
If you introduce user-facing UI terms like “Dependents” or “Paged list”:
- Add minimal entries to `docs/human_dictionary/glossary.md`
- Add implementation notes to agent_dictionary only if it adds clarity

---

### 8) Update `docs/codex_prompts/INDEX.md`
Append an entry for this prompt file (V5.5d4) with commit TBD.

---

## Self-verify (Codex must run)

1) Syntax check:
- `python -m compileall app_ui`

2) Tests (if present):
- `pytest -q` or at least `pytest -q tests/test_codesee_*`

3) Manual UI verification (required):
- Launch app → open CodeSee
- Click several nodes/modules:
  - Relations tab shows sections without lag
- “Load more” works and stays responsive
- Filter reduces list; clearing filter resets paging
- Pin Inspector and confirm click behavior stays predictable
- Use Back/Forward: Relations updates to match inspected item
- In Peek mode (if present): Relations still works

Fix issues before finishing.

---

## Git checkpoint (end of slice)
```bash
git status
git add -A
git commit -m "feat(V5.5d4) add Inspector relations with paging and filters"
git push
```
