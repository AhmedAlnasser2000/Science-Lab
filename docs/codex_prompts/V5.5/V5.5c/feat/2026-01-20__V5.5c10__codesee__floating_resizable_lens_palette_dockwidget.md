# 2026-01-20 — V5.5c10 — CodeSee: make Lens Palette truly floatable + resizable (DockWidget)

**MODEL:** gpt-5.2-codex  
**model_reasoning_effort:** high  
**Justification:** The user reports the palette is docked in a single place and not resizable. Implementing a proper Qt `QDockWidget` (float/move/resize) touches MainWindow layout/state restore and must be done carefully to avoid new recursion/resize loops.

---

## Goal

1) Lens Palette can be **docked** (left/right/bottom), **floated** (tool window), **moved**, and **resized** like a real dock tool.  
2) Works in both CodeSee embedded view and “Open in Window” variant.  
3) Persist/restore placement/geometry safely **without** reintroducing recursion loops (pin toggle, signals).  
4) Keep existing palette UI design (box palette) intact.

---

## Touchlist

- `app_ui/codesee/screen.py` (palette widget + host wiring)
- CodeSee window/host file that owns the QMainWindow (embedded + window)
- `app_ui/codesee/view_config.py` (persist dock state/geometry)

---

## Forbidden list

- Don’t change palette design/icons.
- Don’t remove safety: `PHYSICSLAB_CODESEE_DISABLE`, excepthook guard, QSignalBlocker pin fix.
- No refactors outside CodeSee.

---

## Implementation plan

### 1) Host palette as `QDockWidget`
- Create `QDockWidget("Lenses", mainwindow)` and setWidget(existing `LensPaletteWidget`).
- Features: Movable + Floatable + Closable.
- Allowed dock areas: left/right/bottom.
- Add to both embedded CodeSee host window and CodeSee “Open in Window”.

### 2) Map “Pin” to dock/floating state (no recursion)
Recommended behavior:
- Pinned = docked (`dock.setFloating(False)`)
- Unpinned = floating (`dock.setFloating(True)` + raise)

Sync the pin checkbox from dock signals using `QSignalBlocker`:
- Connect `dock.topLevelChanged(bool)` and `dock.visibilityChanged(bool)`.

### 3) Resizing
- Docked: splitter resize from QMainWindow.
- Floating: normal window resize.
Ensure palette does NOT call `adjustSize()` on ancestors and has sane min sizes.

### 4) Persist layout
Use QMainWindow APIs:
- `saveState()` / `restoreState()` for dock layout
- `saveGeometry()` / `restoreGeometry()` for floating geometry

Persist bytes (base64) in view_config:
- `codesee.dock_state`
- `codesee.dock_geometry`
- `codesee.palette_visible`
- `codesee.palette_floating`

Guard corrupt data (ignore and use defaults).

### 5) Default
If no saved state: dock on right, visible, not floating.

---

## Auto-verify

- `python -m compileall -q app_ui`
- `pytest -q`

---

## Manual verify (Windows)

1) Run `python -m app_ui.main`
2) Open CodeSee embedded: drag dock (L/R/B), resize, Pin float/dock.
3) Open “Open in Window” and repeat.
4) Restart app: state persists.

---

## Commit

`feat(V5.5c10) make CodeSee Lens Palette floatable/resizable via dock widget`

Git checkpoint commands:
```
git add -A
git commit -m "feat(V5.5c10) make CodeSee Lens Palette floatable/resizable via dock widget"
git push
```
