# MODEL: gpt-5.2 codex (reasoning_effort=medium)
# Justification: Multi-file UI/interaction work in CodeSee (Qt), with event handling (click-outside/Esc), state persistence, and small UX polish.

## Goal
Implement **V5.5c1**: a **Floating Lens Palette launcher** for CodeSee to declutter the UI.

Requirements:
- A compact **launcher button** (blue accent) visible in CodeSee.
- **Click** launcher → palette opens; click again → closes.
- **Click-outside** closes palette.
- **Esc** closes palette (when not typing in a text field).
- Palette lists available **lenses / views / modes** (whatever CodeSee currently calls them) and allows switching.
- **Pin / Dock option**:
  - Shift+click launcher toggles pinned (or provide a pin icon inside the palette).
  - When pinned, palette stays open and behaves like a docked/anchored panel.
- Persist pinned state + last selected lens to roaming config (existing settings mechanism).
- Must respect existing profile gating (Explorer) and reduced-motion preferences.

Non-goals (defer): complex inspector panel, virtualized lists, replay UI (V5.5d+).

## Touchlist
1) **Locate CodeSee entry points**
   - Find the CodeSee screen/window class and its toolbar/controls.
   - Identify existing lens switching logic and where “current lens” state lives.

2) **Add launcher button**
   - Prefer: top-left/toolbar near existing lens controls, or a subtle floating corner button.
   - Style: small, blue-accented, consistent with current theme/QSS.

3) **Implement Floating Lens Palette**
   - Qt widget suggestion: `QFrame` or `QWidget` with `Qt.Popup` (or custom) to support click-outside.
   - Contents:
     - Header row with title “Lenses” and a **Pin** toggle.
     - List of lens items (buttons or list rows) with current selection highlighted.
   - Behavior:
     - Open near launcher button (anchored positioning).
     - Close on outside click and Esc (unless pinned).

4) **Click-outside + Esc handling**
   - If using `Qt.Popup`, verify outside click closes automatically; otherwise install an event filter.
   - Ensure Esc does not interfere with modal dialogs/text inputs.

5) **Pin / Dock behavior**
   - When pinned:
     - Palette becomes a normal child widget anchored in layout OR stays floating but non-popup.
     - It should not close on outside click.
   - When unpinned:
     - Revert to popup behavior.

6) **Persist state**
   - Add fields to existing roaming config (prefer under an existing CodeSee settings object).
   - Persist:
     - `codesee.lens_palette.pinned: bool`
     - `codesee.lens_palette.last_lens_id: str`

7) **Polish**
   - Keyboard shortcut(s):
     - `L` toggles palette (only when CodeSee has focus, not typing).
     - `Esc` closes (already).
   - Tooltips for launcher and pin.
   - Ensure layout does not jump when opening/closing.

8) **Docs/Changelog**
   - Update any CodeSee docs/changelog notes for V5.5c1.

## Forbidden list
- Do **not** refactor CodeSee architecture broadly.
- Do **not** add new dependencies.
- Do **not** introduce always-on timers or heavy redraw loops.
- Do **not** break existing lens switching semantics.
- Avoid platform-specific hacks; keep it Qt-portable.

## Auto-verify
Run these locally:
1) Python compile:
   - `python -m compileall app_ui runtime_bus core_center component_runtime -q`
2) Pillars:
   - `pytest -q tests/pillars`

## Manual tests
1) Launch app → open **Code See**.
2) Confirm launcher button is visible and styled correctly.
3) Click launcher → palette opens near it.
4) Click outside palette → closes.
5) Press Esc → closes.
6) Select a different lens from palette → view switches.
7) Shift+click launcher (or pin icon) → palette pins/docks.
8) When pinned, click outside does **not** close.
9) Restart app → CodeSee restores pinned state and last lens.
10) Reduced-motion enabled → palette open/close has no excessive animations.

## Git checkpoint guidance (within this slice)
Commit frequently on your slice branch; suggested final commit message:
- `feat(V5.5c1) CodeSee floating lens palette launcher`

Remember to include docs prompt + INDEX updates in the same PR.
