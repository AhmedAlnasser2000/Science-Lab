# Codex Mega Prompt — V5.5c13: Agent Dictionary + NAV Sprint (v2, based on latest app_ui + agent_dictionary)

This mega prompt is **checkpointed** to prevent silent/wild results. It is based on the *current* `app_ui/` folder and existing `docs/agent_dictionary/*` pages.

## Model / settings
Use **GPT‑5.3‑Codex** with reasoning effort = **Medium**.
- Bump to **High** only if you hit a confusing conflict.
- Do not expand scope.

## Global rules (must follow)
- **STOP at each checkpoint** and report before continuing.
- NAV changes are **comments-only** (no logic/behavior changes).
- No file moves/renames in this sprint.
- No whole-file reformatting; keep diffs tight.
- NAV style must match `app_ui/main.py`:
  - Top-of-file NAV INDEX
  - Section headers `# === [NAV-XX] ...`
  - Optional `# region` / `# endregion` for folding

### STOP & REPORT format (required)
After each checkpoint, output:
1) `git status --porcelain`
2) `git diff --name-only`
3) commands you ran
4) verification results (tests/compile) and whether they passed
5) any notes/risks

User will then say “continue”.

---

## Checkpoint 0 — Baseline snapshot (no edits)
Run:
```bash
git status --porcelain
pytest -q tests/test_codesee_* || true
python -m compileall app_ui -q
```
STOP & REPORT.

---

## Checkpoint 1 — Agent Dictionary expansion (docs-only)
You already have:
- `docs/agent_dictionary/INDEX.md`
- `app_ui.md`, `app_ui_screens.md`, `app_ui_widgets.md`, `app_ui_labs.md`, `app_ui_codesee.md`

Now extend the dictionary for agents (fast map; scannable; not a full spec).

### 1A) Update existing pages (tight edits)
- Update `docs/agent_dictionary/INDEX.md` to include new pages below.
- In `app_ui.md`, add a **“NAV quick jumps”** section with placeholders for:
  - `app_ui/main.py`
  - `app_ui/screens/system_health.py`
  - `app_ui/screens/content_browser.py`
  - `app_ui/kernel_bridge.py`
  - `app_ui/safe_viewer.py`
  - plus new NAV targets (see Checkpoint 2)

- In `app_ui_screens.md`, add entries for the screens that exist (and will get NAV in Checkpoint 2):
  - `block_catalog.py`
  - `block_host.py`
  - `component_management.py`

- In `app_ui_widgets.md`, keep current entries but add placeholder NAV tags (to be filled after Checkpoint 2).
- In `app_ui_labs.md`, expand to include key “host + plumbing” files (below), with placeholders for NAV tags.

### 1B) Create new pages (agent-first, short)
Create:
- `docs/agent_dictionary/repo_stacks.md`  
  Explain triads without moving folders:
  - UI: `ui_repo / ui_system / ui_store`
  - Components: `component_repo / component_runtime / component_store`
  - Content: `content_repo / content_system / content_store`
  Include: what is source vs installed mirror, entrypoints, common pitfalls.

- `docs/agent_dictionary/runtime_bus.md`
- `docs/agent_dictionary/core_center.md`
- `docs/agent_dictionary/content_system.md`
- `docs/agent_dictionary/ui_system.md`
- `docs/agent_dictionary/kernel.md`

These can be “v1” and improved later, but must follow the agent template:
- **Path(s)**
- **Role**
- **Key symbols**
- **Edit-when**
- **Risks/Notes**
- **NAV quick jumps** (placeholders for now)

Verification (docs-only):
```bash
git status --porcelain
```
STOP & REPORT.

---

## Checkpoint 2 — NAV for app_ui files that still lack NAV (comments-only)
These files currently **do not** have NAV (based on latest `app_ui/`):
- `app_ui/config.py`
- `app_ui/ui_scale.py`
- `app_ui/versioning.py`
- `app_ui/window_state.py`
- `app_ui/screens/block_catalog.py`
- `app_ui/screens/block_host.py`
- `app_ui/screens/component_management.py`
- `app_ui/widgets/app_header.py`
- `app_ui/widgets/workspace_selector.py`
- `app_ui/labs/host.py`

(Several others already have NAV: `app_ui/main.py`, `system_health.py`, `workspace_management.py`, `content_browser.py`, `kernel_bridge.py`, `safe_viewer.py` — do NOT duplicate NAV there.)

### NAV guidance (keep it minimal)
For each target file above:
- Add top-of-file NAV INDEX.
- Add 3–8 section headers that reflect the real structure.

Suggested minimal maps:

#### app_ui/config.py
- `[NAV-00] Imports/constants`
- `[NAV-10] Config loading (defaults/roaming/policy)`
- `[NAV-20] Public getters`
- `[NAV-90] Helpers`
- `[NAV-99] End`

#### app_ui/versioning.py
- `[NAV-00] Imports/constants`
- `[NAV-10] Build info / version API`
- `[NAV-90] Helpers`
- `[NAV-99] End`

#### app_ui/ui_scale.py
- `[NAV-00] Imports/constants`
- `[NAV-10] Density/scaling rules`
- `[NAV-20] Apply-to-Qt helpers`
- `[NAV-99] End`

#### app_ui/window_state.py
- `[NAV-00] Imports/constants`
- `[NAV-10] Save/restore window state`
- `[NAV-20] Serialization helpers`
- `[NAV-99] End`

#### app_ui/screens/block_catalog.py
- `[NAV-00] Imports/constants`
- `[NAV-10] Models/data sources`
- `[NAV-20] Screen ctor + UI build`
- `[NAV-30] Filtering/search/sort`
- `[NAV-40] Open/launch flows`
- `[NAV-90] Helpers`
- `[NAV-99] End`

#### app_ui/screens/block_host.py
- `[NAV-00] Imports/constants`
- `[NAV-20] Screen ctor + wiring`
- `[NAV-30] Component mount/host lifecycle`
- `[NAV-40] Back/escape handling`
- `[NAV-90] Helpers`
- `[NAV-99] End`

#### app_ui/screens/component_management.py
- `[NAV-00] Imports/constants`
- `[NAV-10] Inventory/bus helpers`
- `[NAV-20] Screen ctor + UI`
- `[NAV-30] Install/uninstall flows`
- `[NAV-40] Progress/polling`
- `[NAV-90] Helpers`
- `[NAV-99] End`

#### app_ui/widgets/app_header.py
- `[NAV-00] Imports/constants`
- `[NAV-20] AppHeader widget`
- `[NAV-30] Signals/actions`
- `[NAV-99] End`

#### app_ui/widgets/workspace_selector.py
- `[NAV-00] Imports/constants`
- `[NAV-20] WorkspaceSelector widget`
- `[NAV-30] Events + update flow`
- `[NAV-99] End`

#### app_ui/labs/host.py
- `[NAV-00] Imports/constants`
- `[NAV-10] Host context/policy wiring`
- `[NAV-20] LabHost ctor + layout`
- `[NAV-30] Guide panel + tier gating`
- `[NAV-40] Export/actions (policy gated)`
- `[NAV-50] Plugin mount/lifecycle`
- `[NAV-90] Helpers`
- `[NAV-99] End`

### Verification
```bash
pytest -q tests/test_codesee_*
python -m compileall app_ui -q
```
STOP & REPORT.

---

## Checkpoint 3 — Backfill “NAV quick jumps” in the Agent Dictionary
Now that NAV exists in the new targets (and already exists in main/system_health/etc.), update dictionary pages:

- `docs/agent_dictionary/app_ui.md`
- `docs/agent_dictionary/app_ui_screens.md`
- `docs/agent_dictionary/app_ui_widgets.md`
- `docs/agent_dictionary/app_ui_labs.md`
- (optional) `app_ui_codesee.md` if you want to cite key anchors there too

Replace placeholders with real anchors, e.g.:
- `app_ui/labs/host.py [NAV-30] Guide panel`
- `app_ui/config.py [NAV-10] Config loading`
- etc.

Verification:
```bash
git status --porcelain
```
STOP & REPORT.

---

## Checkpoint 4 — Commit plan (user may squash merge later)
Create clean commits (or fewer, if user requests). Recommended:
1) `docs(V5.5c13-mega) expand agent dictionary + stacks`
2) `chore(V5.5c13-mega) add NAV anchors to missing app_ui files`
3) `docs(V5.5c13-mega) backfill NAV quick jumps`

Suggested commands:
```bash
git add -A
git commit -m "docs(V5.5c13-mega) expand agent dictionary + stacks"
git push

git add -A
git commit -m "chore(V5.5c13-mega) add NAV anchors to app_ui files"
git push

git add -A
git commit -m "docs(V5.5c13-mega) backfill NAV quick jumps"
git push
```

Final sanity:
```bash
pytest -q tests/test_codesee_* || true
python -m compileall app_ui -q
```
STOP & REPORT.

---

## Optional future extension (requires full repo provided)
When the full repo is available, we can add NAV batch for:
- `runtime_bus/*`, `core_center/*`, `content_system/*`, `ui_system/*`
and then update `runtime_bus.md`, `core_center.md`, etc. with real anchors.
