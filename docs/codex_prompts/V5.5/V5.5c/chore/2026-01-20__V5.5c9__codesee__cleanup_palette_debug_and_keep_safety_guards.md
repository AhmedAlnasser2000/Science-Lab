# 2026-01-20 — V5.5c9 — CodeSee cleanup: reduce debug spam, keep safety guards

**MODEL:** gpt-5.2-codex  
**model_reasoning_effort:** medium  
**Justification:** Core crash is fixed (pin recursion via QSignalBlocker). Now we should clean up noisy diagnostics and temporary scaffolding while keeping the essential safety/circuit-breaker behavior. This is bounded, mostly single-area refactor + verification.

---

## Goal

1) **Remove noisy debug spam / temporary diagnostics** introduced during the lens palette firefight.  
2) **Keep the important safety mechanisms**:
   - `PHYSICSLAB_CODESEE_DISABLE=1` circuit breaker (do not remove).
   - non-reentrant `sys.excepthook` guard (do not remove).
   - `QSignalBlocker` around programmatic pin sync (do not remove).
3) Leave CodeSee behavior unchanged for users:
   - palette opens, pin/unpin works, search works, More/Less works.
   - no UI regressions.
4) Tests and compile pass.

---

## Touchlist

- `app_ui/codesee/screen.py`
- `app_ui/codesee/runtime/hooks.py`
- `app_ui/codesee/view_config.py` (only if required to remove leftover debug prints)
- `tests/` (only if test needs to be updated due to removed logs)

---

## Forbidden list

- Do not remove the CodeSee disable flag behavior.
- Do not refactor unrelated app systems (kernel/core_center/runtime_bus/content_system/ui_system).
- Do not change UI design of the palette.

---

## Cleanup tasks (do all)

### 1) Audit and classify all debug output
Search within `app_ui/codesee/` for:
- `print(`, `stderr`, “tiles_created”, “available_lenses_total”, “sample_labels”, “grid_count”, “request_refresh”, “refresh begin/end”
- any debug env var checks: `PHYSICSLAB_CODESEE_DEBUG` (or similar)

Classify each output into:
A) **Keep (debug-gated, low frequency)**:
   - One-line summaries on key user actions (open palette, lens changed, pin toggled)
B) **Remove (too spammy / per-layout/per-refresh)**:
   - Anything printed on every refresh, every keystroke, every rebuild, or every paint/layout pass.
C) **Convert to rate-limited debug**:
   - If useful, keep but only log when state actually changes (query changed, filtered count changed, pinned state changed).

### 2) Implement a tiny debug logger helper in `screen.py` (optional but preferred)
If `screen.py` currently uses scattered `print(...)` calls, replace with:

- `def _debug_enabled(self) -> bool: ...`
- `def _dbg(self, msg: str): ...` (only prints if debug enabled)
- `def _dbg_once(self, key: str, msg: str): ...` (dedupe repeated messages)

Store a small set/dict on the widget (e.g., `self._dbg_seen = set()`).

Then:
- Replace high-frequency prints with either removal or `_dbg_once(...)` with stable keys.
- Keep a single “palette status” debug line when:
  - palette is opened
  - lens selection changes
  - pin changes
  - More/Less toggles
  - search query changes (but only once per distinct query string, or rate-limited)

### 3) Remove any temporary “scaffolding-only” UI elements that are no longer needed
Examples (only if they exist):
- placeholder buttons added only for debugging (e.g., extra search button if Enter now works)
- duplicated banners/status labels
- redundant “no results” overlays if a single status line is enough

**Important:** Do not reduce user-visible usability; keep a clear status line:
- “Showing N lenses” or “No matches for ‘query’” (visible even if grid is empty)

### 4) Keep safety guards
Verify these remain:
- `PHYSICSLAB_CODESEE_DISABLE=1` path that disables CodeSee cleanly (skip hooks, show disabled message).
- `sys.excepthook` guard in `runtime/hooks.py`:
  - non-reentrant (no recursion)
  - formatting-safe (try/except around traceback formatting)
- pin sync uses `QSignalBlocker` (with an inline comment explaining why).

### 5) Verify no window-resize side effects
Search for any of these and remove if found (unless truly needed):
- `adjustSize()` on top-level windows
- unbounded `setMinimumHeight` bumps that accumulate
- repeated `setFixedHeight` changes from refresh loops

---

## Auto-verify

Run:
- `python -m compileall -q app_ui`
- `pytest -q`

---

## Manual verify (Windows)

1) Normal run:
   - `python -m app_ui.main`
2) Open CodeSee (embedded + “Open in Window”).
3) Lens Palette:
   - open, type `pla`, clear search, toggle pin, More/Less.
4) Confirm:
   - no spam in terminal in normal mode
   - if you set `PHYSICSLAB_CODESEE_DEBUG=1`, logs are present but not excessive (no floods).

Also confirm circuit breaker still works:
- PowerShell:
  - `$env:PHYSICSLAB_CODESEE_DISABLE=1; python -m app_ui.main`

---

## Commit

**Message:**
- `chore(V5.5c9) reduce CodeSee lens palette debug spam; keep safety guards`

---

## Git checkpoint commands

```
git add -A
git commit -m "chore(V5.5c9) reduce CodeSee lens palette debug spam; keep safety guards"
git push
```
