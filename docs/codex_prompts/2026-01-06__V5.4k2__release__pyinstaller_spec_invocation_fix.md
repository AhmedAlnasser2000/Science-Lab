# 2026-01-06 — V5.4k2 — Release: fix PyInstaller invocation when using a .spec file

Model: **gpt-5.2 (Codex extension)** — reasoning effort **low**  
Justification: small, targeted fix to make packaging runnable; single-file/script change + verify.

---

## Goal

Fix Windows packaging build failure:

Running:
- `python tools/release/build_windows.py --out dist/PhysicsLab`

currently fails with PyInstaller error:
- `ERROR: option(s) not allowed: --specpath`
- `makespec options not valid when a .spec file is given`

This happens because the script is passing **makespec-only options** (like `--specpath`) while also providing a `.spec` file.

Make `build_windows.py` invoke PyInstaller correctly when a `.spec` file is used.

---

## Touchlist

- `tools/release/build_windows.py`
- `docs/codex_prompts/INDEX.md` (append V5.4k2 entry)

---

## Forbidden list

- No refactors beyond the PyInstaller command construction.
- Don’t change the P4 pillars check criteria.
- No new dependencies.

---

## Implementation details

In `tools/release/build_windows.py`, locate where it builds the PyInstaller command.

### Required behavior
- If `args.spec` points to a `.spec` file:
  - Invoke PyInstaller as: `pyinstaller <spec_path> ...`
  - Do **NOT** pass `--specpath` (or any makespec-only option)
  - Use build/run options that are valid with spec files:
    - `--noconfirm`
    - `--clean`
    - `--distpath <out_dir>` (or `<out_dir_parent>`, depending on how you structure)
    - `--workpath <work_dir>` (optional but recommended)
    - `--log-level=INFO` (optional)

- If `args.spec` is a python entry script (not a .spec), you may still use `--specpath` if you are generating a spec. But for V5.4k, we are **building from an existing spec**, so simplest is:
  - treat `args.spec` as a `.spec` path always (default).

### Suggested command shape (spec build)
Example (adjust paths to match script conventions):
```text
pyinstaller build/pyinstaller/physicslab.spec --noconfirm --clean --distpath dist/PhysicsLab --workpath build/pyinstaller/_work
```

Keep stdout/stderr capture so failures still show full logs.

---

## Self-verification (agent must run)

1) Install packaging deps (if not already):
- `python -m pip install -r requirements-packaging.txt`

2) Pillars tests still pass:
- `python -m pytest -q tests/pillars`

3) Packaging script now runs past the previous error:
- `python tools/release/build_windows.py --out dist/PhysicsLab`

Expected:
- No `--specpath` error
- PyInstaller runs (it may still surface new missing-data issues; that’s fine, but this specific failure must be gone)

---

## Manual verification (user)

- `python -m pip install -r requirements-packaging.txt`
- `python tools/release/build_windows.py --out dist/PhysicsLab`
- Confirm the error about `--specpath` is gone.

---

## Completion note

In your completion summary, include:
- the new PyInstaller command line used (from logs)
- whether the build reaches “completed” or what the next blocker is (if any)
