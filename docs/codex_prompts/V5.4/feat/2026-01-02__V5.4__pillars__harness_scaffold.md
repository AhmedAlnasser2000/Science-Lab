# 2026-01-02__V5.4__pillars__harness_scaffold.md

**Model:** gpt-5.1-codex-max  
**Reasoning effort:** high  
**Why:** This touches multiple subsystems (tests + CI + diagnostics host extensibility) and we want a careful, low-regression scaffold.

---

## Goal
Implement the **V5.4 Pillars Verification Harness scaffold** (core + headless), plus the **Diagnostics provider host** plumbing needed for optional future tooling — without adding Code See or any heavy DevTools UI.

This is a *scaffold milestone*: create a stable place to add pillar checks incrementally. Keep behavior conservative; prefer SKIP/TODO checks over risky partial implementations.

---

## Touchlist
### A) New test harness (authoritative)
1) Add `tests/pillars/` with:
   - `test_pillars_smoke.py` (initial checks can be mostly SKIP with clear reasons)
   - `conftest.py` (shared temp workspace fixture)
2) Add a tiny, versioned **Pillars Report** format:
   - `diagnostics/pillars_report.py` (or another appropriate non-UI module)
   - Must include: `report_version`, `generated_at`, `build_id`, `app_version`, `results[]` with `{pillar_id, name, status, details, duration_ms}`
3) Add `tools/pillars_harness.py` (CLI) that:
   - runs the same core checks as tests (import shared functions)
   - writes `pillars_report.json` into a chosen output folder (default: temp; optional: active workspace if available)
   - exits non-zero on FAIL (but allows SKIP)

### B) Diagnostics “provider host” (core, minimal UI change)
4) Add a minimal “Diagnostics Providers” registry API (NO Code See dependency):
   - `app_ui/diagnostics/providers.py` with:
     - `register_provider(provider)` where provider has: `id`, `title`, `is_available(ctx)`, `create_widget(ctx)` (UI) OR `render_text(ctx)` (non-UI)
   - Default to a simple list; no dynamic imports.
5) Wire Diagnostics screen to render provider sections:
   - Add one core provider: **Pillars Status (placeholder)** that just:
     - shows last report path if exists
     - has a button to open report folder
     - (optional) a button to run CLI harness via subprocess *only if safe*; otherwise omit button for now.

### C) CI baseline hook (if repo already has CI, extend; otherwise add minimal)
6) Ensure a Windows CI job runs:
   - Python lint/compile (simple import/py_compile)
   - `pytest -q tests/pillars`
   - Keep runtime short; no GUI required.

### D) Documentation & indexing
7) Ensure `docs/codex_prompts/INDEX.md` exists and append an entry for this prompt file (commit hash left blank).
8) Add a short README note (optional) describing how to run:
   - `pytest -q tests/pillars`
   - `python tools/pillars_harness.py --out <folder>`

---

## Forbidden list
- Do **NOT** add Code See UI, instigators UI, or any new heavy visualizations.
- Do **NOT** create a new “DevTools” module/screen; stick to Diagnostics as a host with providers.
- Do **NOT** introduce background daemons, long-running threads, or telemetry uploads.
- Do **NOT** require PowerShell; keep commands cross-shell where possible.
- Do **NOT** break “Code See removable” assumption: nothing in core should import Code See.

---

## Implementation notes (important)
- Prefer a clean separation:
  - **core check logic** in one place
  - tests and CLI both call into it
- For now, implement only “safe” checks:
  - e.g., check build identity is present (if already exists), check report schema validation, check that writing to output works.
  - Use `pytest.skip()` for pillars not implemented yet with reason strings.
- Keep report JSON stable and versioned so we can migrate later.

---

## Self-verify (required)
Run the following (or closest equivalents on Windows):
1) `python -m py_compile app_ui/**/*.py core_center/**/*.py diagnostics/**/*.py tools/**/*.py` (use a portable glob strategy; avoid bash-only globs)
2) `pytest -q tests/pillars`
3) `python tools/pillars_harness.py --out ./data/roaming/pillars_reports_test` (or a temp folder) and confirm it writes `pillars_report.json`

---

## Manual tests
1) Launch app normally.
2) Open **Diagnostics**.
3) Confirm a “Pillars Status” section exists (even if it only shows “no report yet”).
4) If there is an “Open report folder” button, click it and ensure it behaves safely (no crash).

---

## Output required
- A brief summary of files changed/added.
- Any TODO list for unimplemented pillars should live in `tests/pillars/README.md` or similar, not in scattered comments.
